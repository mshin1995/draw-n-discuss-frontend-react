{"ast":null,"code":"var _jsxFileName = \"/Users/MattShin/Development/Labs/draw-n-discuss/frontend-react/src/components/Canvas.js\";\nimport React, { Component } from 'react';\nimport { ActionCable } from 'react-actioncable-provider';\nimport { HEADERS, API_ROOT } from '../constants';\nimport { CompactPicker } from 'react-color';\nimport InputRange from 'react-input-range';\n\nclass Canvas extends Component {\n  constructor() {\n    super();\n\n    this.draw = () => {\n      console.log(\"this.paths: \", this.paths); // this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n\n      this.paths.forEach(path => {\n        this.ctx.lineWidth = path.strokeWidth;\n        this.ctx.strokeStyle = path.color;\n        this.ctx.beginPath();\n        const list = path.list;\n        this.ctx.moveTo(list[0], list[1]);\n\n        for (let i = 2; i < list.length; i += 2) {\n          this.ctx.lineTo(list[i], list[i + 1]);\n        }\n\n        this.ctx.stroke();\n      });\n    };\n\n    this.makePath = () => {\n      return {\n        color: this.state.color,\n        list: [],\n        strokeWidth: this.state.value\n      };\n    };\n\n    this.handleMouseUpOrLeave = () => {\n      this.drawing = false;\n      this.sendPaths();\n    };\n\n    this.handleMouseDown = () => {\n      this.paths.push(this.makePath());\n      this.drawing = true;\n    };\n\n    this.handleMouseMove = e => {\n      if (!this.drawing) return;\n      let x = ~~((e.clientX - this.rect.left) * 10) / 10;\n      let y = ~~((e.clientY - this.rect.top) * 10) / 10;\n      this.paths[this.paths.length - 1].list.push(x, y);\n      this.draw();\n    };\n\n    this.handleChangeComplete = color => {\n      this.setState({\n        color: color.hex\n      });\n    };\n\n    this.handleReceivedPaths = paths => {\n      console.log('handleReceivedPaths', paths);\n      this.paths = paths._json;\n      this.draw();\n    };\n\n    this.sendPaths = () => {\n      console.log('json', JSON.stringify(this.paths));\n      fetch(\"\".concat(API_ROOT, \"/canvas\"), {\n        method: \"POST\",\n        headers: HEADERS,\n        body: JSON.stringify(this.paths)\n      }).catch(err => {\n        console.log({\n          err\n        });\n      });\n    };\n\n    this.state = {\n      color: '#000000',\n      value: 1\n    };\n    this.ctx = null;\n    this.rect = null;\n    this.canvas = null;\n    this.currentPosition = {\n      x: 0,\n      y: 0\n    };\n    this.previousPosition = {\n      x: 0,\n      y: 0\n    };\n    this.lineStart = {\n      x: 0,\n      y: 0\n    };\n    this.lineEnd = {\n      x: 0,\n      y: 0\n    };\n    this.drawing = false; // this.pressed = false\n    // this.moving = false\n\n    this.paths = [];\n  }\n\n  componentDidMount() {\n    let canvas = document.getElementById(\"canvas\");\n    const ctx = canvas.getContext('2d');\n    this.ctx = ctx;\n    this.rect = canvas.getBoundingClientRect();\n    this.canvas = canvas; // this.mainLoop()\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(ActionCable, {\n      channel: {\n        channel: 'CanvasChannel'\n      },\n      onReceived: this.handleReceivedPaths,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }), React.createElement(\"canvas\", {\n      id: \"canvas\",\n      width: \"500\",\n      height: \"500\",\n      style: {\n        \"borderStyle\": \"solid\",\n        \"borderWidth\": \"3px\",\n        \"borderColor\": \"black\"\n      },\n      onMouseUp: this.handleMouseUpOrLeave,\n      onMouseLeave: this.handleMouseUpOrLeave,\n      onMouseDown: this.handleMouseDown,\n      onMouseMove: this.handleMouseMove,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }), React.createElement(CompactPicker, {\n      color: this.state.color,\n      onChangeComplete: this.handleChangeComplete,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }), React.createElement(InputRange, {\n      maxValue: 5,\n      minValue: 0,\n      step: 1,\n      value: this.state.value,\n      onChange: value => this.setState({\n        value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default Canvas;","map":{"version":3,"sources":["/Users/MattShin/Development/Labs/draw-n-discuss/frontend-react/src/components/Canvas.js"],"names":["React","Component","ActionCable","HEADERS","API_ROOT","CompactPicker","InputRange","Canvas","constructor","draw","console","log","paths","forEach","path","ctx","lineWidth","strokeWidth","strokeStyle","color","beginPath","list","moveTo","i","length","lineTo","stroke","makePath","state","value","handleMouseUpOrLeave","drawing","sendPaths","handleMouseDown","push","handleMouseMove","e","x","clientX","rect","left","y","clientY","top","handleChangeComplete","setState","hex","handleReceivedPaths","_json","JSON","stringify","fetch","method","headers","body","catch","err","canvas","currentPosition","previousPosition","lineStart","lineEnd","componentDidMount","document","getElementById","getContext","getBoundingClientRect","render","channel"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {ActionCable} from 'react-actioncable-provider';\nimport {HEADERS, API_ROOT} from '../constants';\nimport { CompactPicker } from 'react-color';\nimport InputRange from 'react-input-range';\n\nclass Canvas extends Component {\n  constructor () {\n    super ()\n    this.state = {\n      color: '#000000',\n      value: 1\n    }\n\n    this.ctx = null\n    this.rect = null\n    this.canvas = null\n\n    this.currentPosition = {x: 0, y: 0}\n    this.previousPosition = {x: 0, y: 0}\n\n    this.lineStart = {x: 0, y: 0}\n    this.lineEnd = {x: 0, y: 0}\n\n    this.drawing = false\n    // this.pressed = false\n    // this.moving = false\n\n    this.paths = []\n\n  }\n\n  componentDidMount() {\n    let canvas = document.getElementById(\"canvas\");\n    const ctx = canvas.getContext('2d')\n    this.ctx = ctx\n    this.rect = canvas.getBoundingClientRect()\n    this.canvas = canvas\n    // this.mainLoop()\n  }\n\n  draw = () => {\n    console.log(\"this.paths: \", this.paths)\n\n    // this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    this.paths.forEach(path => {\n      this.ctx.lineWidth = path.strokeWidth;\n      this.ctx.strokeStyle = path.color;\n      this.ctx.beginPath();\n      const list = path.list;\n      this.ctx.moveTo(list[0], list[1]);\n      for (let i = 2; i < list.length; i += 2) {\n        this.ctx.lineTo(list[i], list[i + 1]);\n      }\n      this.ctx.stroke();\n    })\n  }\n\n  makePath = () => {\n    return {\n      color: this.state.color,\n      list: [],\n      strokeWidth: this.state.value\n    }\n  }\n\n  // this.canvas.onmouseup = canvas.onmouseleave = e => {\n  //   this.drawing = false;\n  // }\n  handleMouseUpOrLeave = () => {\n    this.drawing = false;\n    this.sendPaths();\n  }\n\n  // this.canvas.onmousedown = e => {\n  //   this.paths.push(makePath());\n  //   this.drawing = true;\n  // }\n  handleMouseDown = () => {\n    this.paths.push(this.makePath());\n    this.drawing = true;\n  }\n\n  // this.canvas.onmousemove = e => {\n  //   if (!drawing) return;\n  //\n  //   let x = ~~((e.clientX - this.rect.left) * 10) / 10\n  //   let y = ~~((e.clientY - this.rect.top) * 10) / 10\n  //   this.paths[paths.length - 1].list.push(x, y);\n  //   this.draw();\n  // }\n  handleMouseMove = (e) => {\n    if (!this.drawing) return;\n\n    let x = ~~((e.clientX - this.rect.left) * 10) / 10\n    let y = ~~((e.clientY - this.rect.top) * 10) / 10\n    this.paths[this.paths.length - 1].list.push(x, y);\n    this.draw();\n  }\n\n  // data to be an array of objects with coordinates: ex. [ {x: 1, y: 1}, {x: 2, y: 2}]\n  //\n  // draw = (line) => {\n  //   const { ctx } = this.state;\n  //     ctx.beginPath();\n  //     ctx.moveTo(line[0].x, line[0].y);\n  //     ctx.lineTo(line[1].x, line[1].y);\n  //     ctx.strokeStyle = \"black\";\n  //     ctx.lineWidth = 2;\n  //     ctx.stroke();\n  // }\n  //\n  //\n  // handleMouseDown = (ev) => {\n  //   this.pressed = true;\n  //   this.lineStart = {x: ev.clientX, y: ev.clientY}\n  // }\n  //\n  // handleMouseUp = (ev) => {\n  //   this.pressed = false;\n  //   this.lineEnd = {x: ev.clientX, y: ev.clientY}\n  //   this.lineHistory.push([this.lineStart, this.lineEnd])\n  // }\n  //\n  // handleMouseMove = (ev) => {\n  //   let xx = ev.clientX;\n  //   let yy = ev.clientY;\n  //   this.currentPosition = {x: xx, y: yy}\n  //   this.moving = true;\n  // }\n  //\n  //\n  //\n  // mainLoop = () => {\n  //   if (this.pressed && this.moving && this.state.pos_prev) {\n  //     this.lineHistory.forEach(line => {\n  //       this.draw(line)\n  //     })\n  //     // fetch(`${API_ROOT}/canvas`, {\n  //     //   method: \"POST\",\n  //     //   headers: HEADERS,\n  //     //   body: JSON.stringify(this.lineHistory)\n  //     // })\n  //     this.moving = false;\n  //   }\n  //\n  //   this.setState({pos_prev: {x: this.state.pos.x, y: this.state.pos.y}});\n  //   setTimeout(this.mainLoop, 250);\n  // }\n\n  handleChangeComplete = (color) => {\n    this.setState({\n      color: color.hex\n    })\n  }\n\n  handleReceivedPaths = (paths) => {\n    console.log('handleReceivedPaths', paths)\n    this.paths = paths._json\n    this.draw()\n  }\n\n  sendPaths = () => {\n    console.log('json', JSON.stringify(this.paths))\n    fetch(`${API_ROOT}/canvas`, {\n      method: \"POST\",\n      headers: HEADERS,\n      body: JSON.stringify(this.paths)\n    })\n    .catch(err => {\n      console.log({err})\n    })\n  }\n\n  render() {\n    return (\n      <div>\n        <ActionCable\n          channel={{channel: 'CanvasChannel'}}\n          onReceived={this.handleReceivedPaths}\n        />\n        <canvas\n          id=\"canvas\"\n          width=\"500\"\n          height=\"500\"\n          style={{\"borderStyle\": \"solid\", \"borderWidth\": \"3px\", \"borderColor\": \"black\"}}\n          onMouseUp={this.handleMouseUpOrLeave}\n          onMouseLeave={this.handleMouseUpOrLeave}\n          onMouseDown={this.handleMouseDown}\n          onMouseMove={this.handleMouseMove}\n        />\n        <CompactPicker\n          color={this.state.color}\n          onChangeComplete={this.handleChangeComplete}\n        />\n        <InputRange\n          maxValue={5}\n          minValue={0}\n          step={1}\n          value={this.state.value}\n          onChange={value => this.setState({ value })}\n        />\n      </div>\n    )\n  }\n\n}\n\nexport default Canvas\n"]},"metadata":{},"sourceType":"module"}